---
layout: post
title:  iOS切面编程多种姿势的选择
date:   2019-07-20 00:00:00 +0800
categories: iOS开发记录
tag: iOS, 切面
comments: true
---

* content
{:toc}
为什么切面 {#why}
==

问题起因
---
假设我们遇到如下的问题：
- 需要记录应用内页面跳转日志.

在iOS中，我们可以通过记录viewDidAppear(_:), viewDidDisappear(_:)方法对的出现次数来判断页面的跳转情况。(当然他们可能不能完全准确地表现这一个记录，需要一些防御机制来保证哪些调用是有效的)

在以上的假设之下，我们的目标是相当明确地，在两个方法的对应实现中插入我们需要的记录代码。

那么，在遇到这个问题的时候，假如没有去考虑切面，按照面向对象的思考方法，我们首先想到的就必须是继承了。创建一个BaseViewController, 让工程中所有的ViewController都继承自这个Base，然后重写以上的两个方法。

如果满足于此，那么这个事情其实到这里就结束了。你已经实现了你想要的功能。

但是这么做会面临几个困境。

1. 在工程已经有一定规模的情况，如果没有全部继承自一个ViewController对其进行改造是代价比较大的。
2. 记录功能是对于一个工程层面的，而这么做之后将其耦合到了一个 ViewController中，如果工程中需要实现其他的对于全局而言的功能，会导致BaseViewController不停膨胀, 不符合面向对象的单一职责原则。
3. 在其他人接手项目的时候，会需要更多的学习成本，无法像开发普通应用程序那样直接创建一个ViewController, 可能需要一个文档来提醒他： 额，你如果创建ViewController需要继承BaseViewController哦 :)

名词约定:
我们可以将这些事件的发生点称之为一个"切面"。
比如页面的出现是一个"切面"，页面的消失是一个"切面"，点击按钮是一个"切面"......

有没有办法去对这些切面操作，得到我们想要的结果呢？
抽象一点，就是我们需要一种姿势去监视我们感兴趣的动作。
比如像上面的日志记录？

答案是有的。
这也就是切面(AOP)编程的应用目标。
下面会分析一下iOS中实现AOP的几种途径和各自的优缺点。


切面方式{#how}
==

总结{#sum}
==
